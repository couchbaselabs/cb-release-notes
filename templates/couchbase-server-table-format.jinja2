{% macro generate_issue_table(issues, title, components, suffix) %}
{% set filtered_issues = issues | filter_by_component(components) %}

{% if filtered_issues | length > 0 %}

    {{- "=== " ~  title ~ "\n" }}

    {{- "[#table-known-issues-" ~  user_settings.fields.release_number | replace_dots('') ~ "-" ~  suffix ~ ", cols='10,40,40']\n" }}

    {{- "|===\n" }}

    {{- "|Issue | Description | Resolution\n" }}

    {% for issue in filtered_issues %}
        {% if 'raw_note' in issue.fields['customfield_11288'][0] %}

            {{- issue.raw['fields']['customfield_11402']
            | convert_to_asciidoc_urls(user_settings.convert_urls)
            | replace(". ", ". \n")
            | replace("\n\n", "\n") }}

        {% else %}

            {{- "|" ~url_with_jira(user_settings.release_set.url, issue.key) }}

            {% if not issue.fields['customfield_11402']  %}
                {{- "a|" ~ issue.fields.ai_summary or '{empty}' }}

            {% if issue.fields.ai_service is defined %}
            {{- "// Generated by [" ~  issue.fields.ai_service['name'] ~ ":" ~ issue.fields.ai_service['model'] ~"]" }}
            {% endif %}

           {% else %}
                {{- "a|" ~ issue.raw['fields']['customfield_11402']
                | convert_to_asciidoc_urls(user_settings.convert_urls)
                | replace("{{", "`")  | replace("}}", "`")
                | replace(". ", ". \n")
                | replace("\n\n", "\n") }}

           {% endif %}

           {{- "| Issue resolved"}}

        {%  endif %}

    {% endfor %}

    {{- "|===" }}

{% endif %}
{% endmacro %}

[#release-{{ user_settings.fields.release_number | replace_dots('') }}]
== Release {{ user_settings.fields.release_number }} ({{ user_settings.fields.release_date }})

Couchbase Server {{ user_settings.fields.release_number }} was released in {{ user_settings.fields.release_date }}.
This maintenance release contains fixes to issues.

== Fixed Issues

{% include "docs-server-components.jinja2" %}