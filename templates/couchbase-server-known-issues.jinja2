{%- macro generate_issue_table(issues, title, components, suffix) %}
{% set filtered_issues = issues | filter_by_component(components) %}

{%- if filtered_issues | length > 0 -%}

    {{- "[#dlist-known-issues-" ~ user_settings.fields.release_text | replace_dots('') ~ "-" ~ suffix ~ "]\n"}}
    {{- "== " ~ title }}

    {% for issue in filtered_issues %}

        {{- "*" ~ url_with_jira(user_settings.release_set.url, issue.key) ~ "*::"}}

        {% if not issue.fields['customfield_11402']  %}
            {{- issue.fields.ai_summary or '{empty}' -}}

            {% if issue.fields.ai_service is defined %}
                {{- "\n\n// generated by " ~ issue.fields.ai_service['name'] ~ ":" ~ issue.fields.ai_service['model'] ~ "\n"  }}
            {% endif %}

        {% else %}
            {{- issue.raw['fields']['customfield_11402'] | replace("{{", "`")  | replace("}}", "`") | replace("\n\n", "\n")  }}
        {% endif %}

   {% endfor %}

{%- endif %}

{%- endmacro %}


{% macro generate_uncategorized_issue_table(issues, title, components, suffix) %}
{% set filtered_issues = issues | filter_out_by_component(components) %}

{% if filtered_issues | length > 0 %}
=== {{ title }}

[#dlist-known-issues-{{ user_settings.fields.release_text | replace_dots('') }}-{{ suffix }}]

{% for issue in filtered_issues %}

*{{ url_with_jira(user_settings.release_set.url, issue.key) }}*::

{% if issue.fields['customfield_11402'] is not none and issue.fields['customfield_11402'] | length > 0 %}
{{ issue.raw['fields']['customfield_11402'] | replace("{{", "`")  | replace("}}", "`") | replace("\n\n", "\n") }}
{% else %}
{{ issue.fields.ai_summary or '{empty}' }}

{% if issue.fields.ai_service is defined %}
// Generated by [{{ issue.fields.ai_service['name']}}:{{ issue.fields.ai_service['model'] }}]
{% endif %}

{% endif %}
{% endfor %}
{% endif %}
{% endmacro %}



[#known-issues-{{ user_settings.fields.release_text | replace_dots('') }}]
== Known Issues {{ user_settings.fields.release_text }} ({{ user_settings.fields.release_date }})

For Couchbase Server {{ user_settings.fields.release_text }} was released in {{ user_settings.fields.release_date }},
these are the known issues that arenâ€™t yet resolved.


{% include "docs-server-components.jinja2" %}
