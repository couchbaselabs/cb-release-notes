{%- macro generate_issue_table(filtered_issues, title, suffix) %}

{% if filtered_issues | length > 0 -%}

    {{- "[#dlist-fixed-issues-" ~ user_settings.fields.release_text | replace_dots('') ~ "-" ~ suffix ~ "]\n"}}
    {{- "=== " ~ title }}

    {% for issue in filtered_issues %}

        {{- "*" ~ url_with_jira(user_settings.release_set.url, issue.key) ~ "*::"}}

        {% if not issue.fields[user_settings.release_set.release_note_field]  %}
            {{- issue.fields.ai_summary  | replace(", ", ",\n")
            | replace(". ", ".\n") or '{empty}' -}}

            {% if issue.fields.ai_service is defined %}
                {{- "\n\n// generated by " ~ issue.fields.ai_service['name'] ~ ":" ~ issue.fields.ai_service['model'] ~ "\n"  }}
            {% endif %}

        {% else %}
            {{- issue.raw['fields'][user_settings.release_set.release_note_field]
            | convert_to_asciidoc_urls(user_settings.disable_urls)
            | replace("{{", "`")
            | replace("}}", "`")
            | replace(". ", ".\n")
            | replace("\n\n", "\n")  }}
        {% endif %}

   {% endfor %}

{%- endif %}

{%- endmacro %}



[#release-{{ user_settings.fields.release_text | replace_dots('') }}]
== Release {{ user_settings.fields.release_text }} ({{ user_settings.fields.release_date }})

Couchbase Server {{ user_settings.fields.release_text }} was released in {{ user_settings.fields.release_date }}.
This maintenance release contains fixes to issues.

{{ "[#dlist-fixed-issues-" ~ user_settings.fields.release_text | replace_dots('') ~ "]"}}
== Fixed Issues

{% include "docs-server-components.jinja2" %}
