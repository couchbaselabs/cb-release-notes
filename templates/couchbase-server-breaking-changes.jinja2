{% macro generate_issue_table(issues, title, components, suffix) %}
{% set filtered_issues = issues | filter_by_component(components) %}

{% if filtered_issues | length > 0 %}
=== {{ title }}

[#breaking-changes-{{ user_settings.fields.release_text | replace_dots('') }}-{{ suffix }}]

{% for issue in filtered_issues %}

    {{- "*" ~ url_with_jira(user_settings.release_set.url, issue.key) ~ "*::" }}

    {% if not issue.fields[user_settings.release_set.release_note_field]  %}
    {{- issue.fields.ai_summary | replace(",", ",\n") | replace(".", ".\n") or '{empty}' }}

    {% if issue.fields.ai_service is defined %}
      {{- "//" ~ "Generated by [" ~ issue.fields.ai_service['name'] ~":" ~  issue.fields.ai_service['model'] ~ "]"}}
    {% endif %}

    {% else %}
        {{- issue.raw['fields'][user_settings.release_set.release_note_field]
        | convert_to_asciidoc_urls(user_settings.disable_urls)
        | replace(", ", ",\n")
        | replace("{{", "`")  | replace("}}", "`")
        | replace(". ", ".\n")
        }}
    {% endif %}
{% endfor %}
{% endif %}
{% endmacro %}

[#breaking-changes-{{ user_settings.fields.release_text | replace_dots('') }}]
== Breaking changes {{ user_settings.fields.release_text }} ({{ user_settings.fields.release_date }})

Couchbase Server {{ user_settings.fields.release_text }} was released in {{ user_settings.fields.release_date }}.
This maintenance release contains the following breaking changes:

{% include "docs-server-components.jinja2" %}
