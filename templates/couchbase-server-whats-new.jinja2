{% macro generate_issue_table(issues, title, components, suffix) %}
{% set filtered_issues = issues | filter_by_component(components) %}

{% if filtered_issues | length > 0 %}

[#dlist-whats-new-{{ user_settings.fields.release_text | replace_dots('') }}-{{ suffix }}]
== {{ title }}

    {% for issue in filtered_issues %}

        {{- "*" ~ url_with_jira(user_settings.release_set.url, issue.key) ~ "*::"}}

        {% if not issue.fields['customfield_11402']  %}
            {{- issue.fields.ai_summary or '{empty}' -}}

            {% if issue.fields.ai_service is defined %}
                {{ "\n\n// generated by " ~ issue.fields.ai_service['name'] ~ ":" ~ issue.fields.ai_service['model'] ~ "\n"  }}
            {% endif %}

        {% else %}
            {{- issue.raw['fields']['customfield_11402']
            | convert_to_asciidoc_urls
            | replace("{{", "`")
            | replace("}}", "`")
            | replace("\n\n", "\n")  }}
        {% endif %}

   {% endfor %}

{% endif %}

{%- endmacro -%}


[#whats-new-{{ user_settings.fields.release_text | replace_dots('') }}]
== What's New in {{ user_settings.fields.release_text }} ({{ user_settings.fields.release_date }})

Couchbase Server {{ user_settings.fields.release_text }} was released in {{ user_settings.fields.release_date }}.
New features and improvements are described below.

== New Features

{% include "docs-server-components.jinja2" %}
